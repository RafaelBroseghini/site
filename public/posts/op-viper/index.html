<!DOCTYPE html>
<html lang="en-us"
  dir="ltr">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">








    






<link rel="icon" type="image/ico" href="https://rafaelbroseghini.com/favicon/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://rafaelbroseghini.com/favicon/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://rafaelbroseghini.com/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="192x192" href="https://rafaelbroseghini.com/favicon/android-chrome-192x192.png">
<link rel="apple-touch-icon" sizes="180x180" href="https://rafaelbroseghini.com/favicon/apple-touch-icon.png">

<meta name="description" content=""/>



<title>
    
    1Password and Go Configuration | rafaelbroseghini.com
    
</title>

<link rel="canonical" href="https://rafaelbroseghini.com/posts/op-viper/"/>

<meta property="og:url" content="https://rafaelbroseghini.com/posts/op-viper/">
  <meta property="og:site_name" content="rafaelbroseghini.com">
  <meta property="og:title" content="1Password and Go Configuration">
  <meta property="og:description" content="injecting 1Password values securely at runtime">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-09-25T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-09-25T00:00:00+00:00">
    <meta property="article:tag" content="Go">
    <meta property="article:tag" content="1Password">












<link rel="stylesheet" href="/assets/combined.min.56b1873d8852f8a5a109abda36c1bfcde55cb48e5bcbe0d8c934a196a7dc374a.css" media="all">






<script
  async
  defer
  data-website-id="9b9456bb-75e9-43da-9e93-44d014bd324f"
  src="https://cloud.umami.is/script.js"
></script>











    




</head>







<body class="auto">

  <div class="content">
    <header>
      

<div class="header">

    

    <h1 class="header-title">
        <a href="https://rafaelbroseghini.com/">rafaelbroseghini.com</a>
    </h1>

    <div class="header-menu">
        

        
        

        <p
            class="small ">
            <a href="/" >
                /home
            </a>
        </p>
        

        <p
            class="small ">
            <a href="/posts" >
                /posts
            </a>
        </p>
        

        <p
            class="small ">
            <a href="/about" >
                /about
            </a>
        </p>
        

        <p
            class="small ">
            <a href="/tags" >
                /tags
            </a>
        </p>
        
        
    </div>

    

</div>

    </header>

    <main class="main">
      




<div class="breadcrumbs"><a href="/">Home</a><span class="breadcrumbs-separator">/</span><a href="/posts/">Posts</a><span class="breadcrumbs-separator">/</span>
        <a href="/posts/op-viper/">1Password and Go Configuration</a></div>


<div >
  <article>
    <header class="single-intro-container">
        
        <h1 class="single-title">1Password and Go Configuration</h1>
        <p class="single-summary">injecting 1Password values securely at runtime</p>
        
        <div class="single-subsummary">
          
          <div>
            
            <p class="single-date">
              <time datetime="2025-09-25T00:00:00&#43;00:00">September 25, 2025</time>
              &nbsp; ¬∑ &nbsp;4 min read
            </p>
          </div>
        </div>
        
    </header>    
        <div class="single-tags"><span>
                  <a href="https://rafaelbroseghini.com/tags/go/">#Go</a>
                </span><span>
                  <a href="https://rafaelbroseghini.com/tags/1password/">#1Password</a>
                </span>
        </div>
    
    <div class="single-content">
      <h2 class="heading" id="application-configuration">
  Application Configuration
  <a class="anchor" href="#application-configuration">#</a>
</h2>
<p>As with any application, we often need to configure a combination of settings. Some may be public and fixed, while others are sensitive and must be stored securely. Most will need different values across environments.</p>
<p>A common approach is to supply environment variables to the application via external processes‚Äîsuch as a <code>.env</code> file, shell scripts, or <code>sed</code> replacements.</p>
<p>For remote deployments, the process might look a bit different. You might have a CI/CD pipeline that sets environment variables, or a secrets‚Äëmanagement solution that injects them into your deployment via a volume mount or other means.</p>
<p>I&rsquo;ve used a combination of both approaches over the years. They work well and follow the <a href="https://www.12factor.net/config">Twelve‚ÄëFactor App</a> guidance. Great!</p>
<p>For the sake of velocity, I set out to store configuration consistently across environments while still managing it securely. It was important to have the same experience in local development and remote deployment.</p>
<h2 class="heading" id="enter-1password">
  Enter 1Password
  <a class="anchor" href="#enter-1password">#</a>
</h2>
<p><a href="https://developer.1password.com/">1Password</a> is a password manager I&rsquo;ve used for quite some time. They provide a great developer experience across the CLI, API, and SDKs.</p>
<p>They offer authorization via browseruser consent, service accounts, and the Connect server access token. I haven&rsquo;t used the Connect server access token, but I&rsquo;ve used the <a href="https://developer.1password.com/docs/cli/">op CLI</a> and <a href="https://developer.1password.com/docs/service-accounts">service accounts</a> extensively.</p>
<p>With the CLI, you don&rsquo;t need additional secrets in your environment to authenticate with 1Password. However, it&rsquo;s harder to use in remote deployments because it requires the user to <a href="https://developer.1password.com/docs/cli/get-started#step-3-enter-any-command-to-sign-in">authorize access</a> to the 1Password account, which it might be cumbersome to do in a remote environment.</p>
<h2 class="heading" id="enter-op-viper">
  Enter op-viper
  <a class="anchor" href="#enter-op-viper">#</a>
</h2>
<p><a href="https://github.com/rafaelbroseghini/op-viper">op-viper</a> is a tool I created to bridge 1Password and Go configuration using <a href="https://github.com/spf13/viper">viper</a>. It lets me store secrets in 1Password and inject them into my application at runtime via 1Password references.</p>
<h2 class="heading" id="installing-op-viper">
  Installing op-viper
  <a class="anchor" href="#installing-op-viper">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go get github.com/rafaelbroseghini/op-viper
</span></span></code></pre></div><h2 class="heading" id="how-it-works">
  How it works
  <a class="anchor" href="#how-it-works">#</a>
</h2>
<p>Let&rsquo;s say I have a configuration file like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ca9ee6">database</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">host</span>: <span style="color:#a6d189">&#34;localhost&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">port</span>: <span style="color:#ef9f76">5432</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">username</span>: <span style="color:#a6d189">&#34;{{ op://vault/item/username }}&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">password</span>: <span style="color:#a6d189">&#34;{{ op://vault/item/password }}&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ca9ee6">api</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">key</span>: <span style="color:#a6d189">&#34;{{ op://production/api-key }}&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">secret</span>: <span style="color:#a6d189">&#34;{{ op://production/api-secret }}&#34;</span>
</span></span></code></pre></div><h3 class="heading" id="using-op-viper-with-the-cli">
  Using op-viper with the CLI
  <a class="anchor" href="#using-op-viper-with-the-cli">#</a>
</h3>
<p>Let&rsquo;s say I have the following Go code:</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#81c8be">package</span> main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81c8be">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#a6d189">&#34;context&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6d189">&#34;github.com/spf13/viper&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6d189">&#34;github.com/rafaelbroseghini/op-viper/pkg/onepassword&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e78284">type</span> Config <span style="color:#e78284">struct</span> {
</span></span><span style="display:flex;"><span>    DatabaseURL <span style="color:#e78284">string</span> <span style="color:#a6d189">`mapstructure:&#34;database_url&#34;`</span>
</span></span><span style="display:flex;"><span>    APIKey      <span style="color:#e78284">string</span> <span style="color:#a6d189">`mapstructure:&#34;api_key&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e78284">func</span> <span style="color:#8caaee">main</span>() {
</span></span><span style="display:flex;"><span>    v <span style="color:#99d1db;font-weight:bold">:=</span> viper.<span style="color:#8caaee">New</span>()
</span></span><span style="display:flex;"><span>    v.<span style="color:#8caaee">SetConfigType</span>(<span style="color:#a6d189">&#34;yaml&#34;</span>)
</span></span><span style="display:flex;"><span>    v.<span style="color:#8caaee">SetConfigName</span>(<span style="color:#a6d189">&#34;config.yaml&#34;</span>)
</span></span><span style="display:flex;"><span>    v.<span style="color:#8caaee">AddConfigPath</span>(<span style="color:#a6d189">&#34;.&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    v.<span style="color:#8caaee">ReadInConfig</span>()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#e78284">var</span> config Config
</span></span><span style="display:flex;"><span>    l <span style="color:#99d1db;font-weight:bold">:=</span> onepassword.<span style="color:#8caaee">NewDefaultLoader</span>()
</span></span><span style="display:flex;"><span>    v.<span style="color:#8caaee">Unmarshal</span>(<span style="color:#99d1db;font-weight:bold">&amp;</span>config, viper.<span style="color:#8caaee">DecodeHook</span>(l.<span style="color:#8caaee">OnePasswordHookFunc</span>(context.<span style="color:#8caaee">Background</span>())))
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>As part of unmarshaling, <code>op-viper</code> replaces 1Password references with actual values and binds them to the <code>Config</code> struct. <code>NewDefaultLoader()</code> executes <code>op</code> shell commands to fetch values from 1Password. If the token has expired or is not present, it prompts the user to authorize access to their 1Password account.</p>
<h3 class="heading" id="using-op-viper-with-service-accounts">
  Using op-viper with service accounts
  <a class="anchor" href="#using-op-viper-with-service-accounts">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#81c8be">package</span> main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81c8be">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#a6d189">&#34;context&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6d189">&#34;github.com/spf13/viper&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6d189">&#34;github.com/rafaelbroseghini/op-viper/pkg/onepassword&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e78284">type</span> Config <span style="color:#e78284">struct</span> {
</span></span><span style="display:flex;"><span>    DatabaseURL <span style="color:#e78284">string</span> <span style="color:#a6d189">`mapstructure:&#34;database_url&#34;`</span>
</span></span><span style="display:flex;"><span>    APIKey      <span style="color:#e78284">string</span> <span style="color:#a6d189">`mapstructure:&#34;api_key&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e78284">func</span> <span style="color:#8caaee">main</span>() {
</span></span><span style="display:flex;"><span>    v <span style="color:#99d1db;font-weight:bold">:=</span> viper.<span style="color:#8caaee">New</span>()
</span></span><span style="display:flex;"><span>    v.<span style="color:#8caaee">SetConfigType</span>(<span style="color:#a6d189">&#34;yaml&#34;</span>)
</span></span><span style="display:flex;"><span>    v.<span style="color:#8caaee">SetConfigName</span>(<span style="color:#a6d189">&#34;config.yaml&#34;</span>)
</span></span><span style="display:flex;"><span>    v.<span style="color:#8caaee">AddConfigPath</span>(<span style="color:#a6d189">&#34;.&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    v.<span style="color:#8caaee">ReadInConfig</span>()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#e78284">var</span> config Config
</span></span><span style="display:flex;"><span>    ctx <span style="color:#99d1db;font-weight:bold">:=</span> context.<span style="color:#8caaee">Background</span>()
</span></span><span style="display:flex;"><span>    sdkClient <span style="color:#99d1db;font-weight:bold">:=</span> onepassword.<span style="color:#8caaee">NewOnePasswordSDKClient</span>(
</span></span><span style="display:flex;"><span>        ctx,
</span></span><span style="display:flex;"><span>        <span style="color:#a6d189">&#34;my-app&#34;</span>,           <span style="color:#737994;font-style:italic">// integration name</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6d189">&#34;1.0.0&#34;</span>,           <span style="color:#737994;font-style:italic">// version</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6d189">&#34;your-service-account-token&#34;</span>,
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    loader <span style="color:#99d1db;font-weight:bold">:=</span> onepassword.<span style="color:#8caaee">NewLoader</span>(
</span></span><span style="display:flex;"><span>        onepassword.<span style="color:#8caaee">WithSDKClient</span>(sdkClient),
</span></span><span style="display:flex;"><span>        onepassword.<span style="color:#8caaee">WithPrefix</span>(<span style="color:#a6d189">&#34;${&#34;</span>),  <span style="color:#737994;font-style:italic">// Custom prefix</span>
</span></span><span style="display:flex;"><span>        onepassword.<span style="color:#8caaee">WithSuffix</span>(<span style="color:#a6d189">&#34;}&#34;</span>),   <span style="color:#737994;font-style:italic">// Custom suffix</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    v.<span style="color:#8caaee">Unmarshal</span>(<span style="color:#99d1db;font-weight:bold">&amp;</span>config, viper.<span style="color:#8caaee">DecodeHook</span>(loader.<span style="color:#8caaee">OnePasswordHookFunc</span>(ctx)))
</span></span></code></pre></div><p>With this approach, <code>op-viper</code> uses the <a href="https://github.com/1Password/onepassword-sdk-go">onepassword-sdk-go</a> client to fetch values from 1Password and bind them to the <code>Config</code> struct. This requires a service account token to be available (via <code>OP_SERVICE_ACCOUNT_TOKEN</code> environment variable) before running the application.</p>
<p>In a real application, you may want to detect the runtime environment and choose between the CLI or SDK client loader.</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#99d1db;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span><span style="color:#e78284">var</span> loader onepassword.Loader
</span></span><span style="display:flex;"><span><span style="color:#ca9ee6">if</span> <span style="color:#8caaee">isLocalEnvironment</span>() {
</span></span><span style="display:flex;"><span>    loader = onepassword.<span style="color:#8caaee">NewDefaultLoader</span>()
</span></span><span style="display:flex;"><span>} <span style="color:#ca9ee6">else</span> {
</span></span><span style="display:flex;"><span>    loader = onepassword.<span style="color:#8caaee">NewLoader</span>(
</span></span><span style="display:flex;"><span>        onepassword.<span style="color:#8caaee">WithSDKClient</span>(sdkClient),
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 class="heading" id="conclusion">
  Conclusion
  <a class="anchor" href="#conclusion">#</a>
</h2>
<p><code>op-viper</code> lets me ditch <code>.env</code> files, shell scripts, and other approaches for injecting configuration, and use a consistent approach to managing configuration across environments.</p>
<p>To be transparent, changes to 1Password references in your config files require redeploying the application, which might not be ideal for some use cases. If you work solo or in a small team where configuration doesn&rsquo;t change frequently, this might be a good fit for you üôÇ</p>
<p>Check out the <a href="https://github.com/rafaelbroseghini/op-viper">repository</a> for more details!</p>

    </div>
  </article>

  

  

  
  

<div class="single-pagination">
    <hr />

    <div class="flexnowrap">

        <div class="single-pagination-prev">
            
            <div class="single-pagination-container-prev">
                <div class="single-pagination-text">‚Üê</div>
                <div class="single-pagination-text">
                    <a href="/posts/uuid7/">
                        uuid7 - indexable and time sortable
                    </a>
                </div>
            </div>
            
        </div>

        <div class="single-pagination-next">
            
        </div>

    </div>

    <hr />
</div>



  

  

  
  <div class="back-to-top">
    <a href="#top">
      back to top
    </a>
  </div>
  

</div>


    </main>
  </div>

  
  





    




  <footer>
    


  </footer>

  
</body>

<script src="/js/theme-switch.js"></script>
<script defer src="/js/copy-code.js"></script>
</html>
