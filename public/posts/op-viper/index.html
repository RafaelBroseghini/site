<!DOCTYPE html>
<html lang="en-us"
  dir="ltr">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">



<link rel="icon" type="image/ico" href="https://rafaelbroseghini.com/favicon/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://rafaelbroseghini.com/favicon/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://rafaelbroseghini.com/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="192x192" href="https://rafaelbroseghini.com/favicon/android-chrome-192x192.png">
<link rel="apple-touch-icon" sizes="180x180" href="https://rafaelbroseghini.com/favicon/apple-touch-icon.png">

<meta name="description" content=""/>



<title>
    
    1Password and Go Configuration | rafaelbroseghini.com
    
</title>

<link rel="canonical" href="https://rafaelbroseghini.com/posts/op-viper/"/>

<meta property="og:url" content="https://rafaelbroseghini.com/posts/op-viper/">
  <meta property="og:site_name" content="rafaelbroseghini.com">
  <meta property="og:title" content="1Password and Go Configuration">
  <meta property="og:description" content="injecting 1password values securely at runtime">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-09-25T18:11:08-05:00">
    <meta property="article:modified_time" content="2025-09-25T18:11:08-05:00">
    <meta property="article:tag" content="Go">
    <meta property="article:tag" content="1password">













<link rel="stylesheet" href="/assets/combined.min.32c4505ff6f37c4a072861f2cbad7347d8e8e8c8f60e01107b50d77c8c29f9f6.css" media="all">






<script
  async
  defer
  data-website-id="9b9456bb-75e9-43da-9e93-44d014bd324f"
  src="https://cloud.umami.is/script.js"
></script>





</head>







<body class="auto">

  <div class="content">
    <header>
      

<div class="header">

    

    <h1 class="header-title">
        <a href="https://rafaelbroseghini.com/">rafaelbroseghini.com</a>
    </h1>

    <div class="flex">
        

        
        
      
        <p class="small ">
            <a href="/" >
                /home
            </a>
        </p>
        
      
        <p class="small ">
            <a href="/posts" >
                /posts
            </a>
        </p>
        
      
        <p class="small ">
            <a href="/about" >
                /about
            </a>
        </p>
        
      
        <p class="small ">
            <a href="/tags" >
                /tags
            </a>
        </p>
        
        
    </div>

    

</div>

    </header>

    <main class="main">
      





<div class="breadcrumbs">
    
    <a href="/">Home</a>
    <span class="breadcrumbs-separator"> > </span>
    
    <a href="/posts/">Posts</a>
    <span class="breadcrumbs-separator"> > </span>
    
    <a class="breadcrumbs-current" href="/posts/op-viper/">1Password and Go Configuration</a>
</div>



<div >

  <div class="single-intro-container">

    

    <h1 class="single-title">1Password and Go Configuration</h1>
    
    <p class="single-summary">injecting 1password values securely at runtime</p>
    

    

    <p class="single-readtime">
      
      
      
      <time datetime="2025-09-25T18:11:08-05:00">September 25, 2025</time>
      

      
      &nbsp; · &nbsp;
      2 min read
      
    </p>

  </div>

  

  
  

  <div class="single-tags">
    
    <span>
      <a href="https://rafaelbroseghini.com/tags/go/">#Go</a>
    </span>
    
    
    <span>
      <a href="https://rafaelbroseghini.com/tags/1password/">#1password</a>
    </span>
    
    
  </div>

  
  

  

  

  

  <div class="single-content">
    <h2 class="heading" id="why-i-created-op-viper">
  Why I Created op-viper
  <a class="anchor" href="#why-i-created-op-viper">#</a>
</h2>
<p>As with any application, I needed to configure it with a variety of settings. Some could be public and fixed, others were sensitive and needed to be stored securely.</p>
<p>The common approach is to bring environment variables into the application using some process. Maybe a <code>.env</code> file, bash scripts, etc. When it comes to remote deployment your process might actually look slightly different. You might have a CI/CD pipeline that takes care of setting the environment variables or a secret management solution that injects them into your deployment.</p>
<p>I have used a combination of both approaches over the years. They work fine and follow the 12 factor app principles. Great!</p>
<p>For the sake of velocity, I wanted to find a way to store my configuration homogeneously across environments while still being able to manage them securely.</p>
<h2 class="heading" id="enter-1password">
  Enter 1Password
  <a class="anchor" href="#enter-1password">#</a>
</h2>
<p>1Password is a password manager that I have been using for quite some time now. They provide a great developer experience across the CLI, API, and SDKs.</p>
<h2 class="heading" id="enter-op-viper">
  Enter op-viper
  <a class="anchor" href="#enter-op-viper">#</a>
</h2>
<p><a href="https://github.com/rafaelbroseghini/op-viper">op-viper</a> is a tool that I created to bridge 1Password and Go configuration using <code>viper</code>. It&rsquo;s a simple tool that allows me to store my configuration in 1Password and inject it into my application at runtime.</p>
<h2 class="heading" id="how-it-works">
  How it works
  <a class="anchor" href="#how-it-works">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go get github.com/rafaelbroseghini/op-viper
</span></span></code></pre></div><p>Let&rsquo;s say I have a configuration file like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ca9ee6">database</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">host</span>: <span style="color:#a6d189">&#34;localhost&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">port</span>: <span style="color:#ef9f76">5432</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">username</span>: <span style="color:#a6d189">&#34;{{ op://vault/item/username }}&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">password</span>: <span style="color:#a6d189">&#34;{{ op://vault/item/password }}&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ca9ee6">api</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">key</span>: <span style="color:#a6d189">&#34;{{ op://production/api-key }}&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">secret</span>: <span style="color:#a6d189">&#34;{{ op://production/api-secret }}&#34;</span>
</span></span></code></pre></div><p>Let&rsquo;s say I have the following Go code:</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#81c8be">package</span> main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81c8be">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#a6d189">&#34;context&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6d189">&#34;github.com/spf13/viper&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6d189">&#34;github.com/rafaelbroseghini/op-viper/pkg/onepassword&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e78284">type</span> Config <span style="color:#e78284">struct</span> {
</span></span><span style="display:flex;"><span>    DatabaseURL <span style="color:#e78284">string</span> <span style="color:#a6d189">`mapstructure:&#34;database_url&#34;`</span>
</span></span><span style="display:flex;"><span>    APIKey      <span style="color:#e78284">string</span> <span style="color:#a6d189">`mapstructure:&#34;api_key&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e78284">func</span> <span style="color:#8caaee">main</span>() {
</span></span><span style="display:flex;"><span>    v <span style="color:#99d1db;font-weight:bold">:=</span> viper.<span style="color:#8caaee">New</span>()
</span></span><span style="display:flex;"><span>    v.<span style="color:#8caaee">SetConfigType</span>(<span style="color:#a6d189">&#34;yaml&#34;</span>)
</span></span><span style="display:flex;"><span>    v.<span style="color:#8caaee">SetConfigName</span>(<span style="color:#a6d189">&#34;config.yaml&#34;</span>)
</span></span><span style="display:flex;"><span>    v.<span style="color:#8caaee">AddConfigPath</span>(<span style="color:#a6d189">&#34;.&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    v.<span style="color:#8caaee">ReadInConfig</span>()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#e78284">var</span> config Config
</span></span><span style="display:flex;"><span>    l <span style="color:#99d1db;font-weight:bold">:=</span> onepassword.<span style="color:#8caaee">NewDefaultLoader</span>()
</span></span><span style="display:flex;"><span>    v.<span style="color:#8caaee">Unmarshal</span>(<span style="color:#99d1db;font-weight:bold">&amp;</span>config, viper.<span style="color:#8caaee">DecodeHook</span>(l.<span style="color:#8caaee">OnePasswordHookFunc</span>(context.<span style="color:#8caaee">Background</span>())))
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>As part of the unmarshalling, <code>op-viper</code> will replace 1password references with the actual values and bind them to the <code>Config</code> struct.</p>
<p>This allows me to ditch <code>.env</code> files, bash scripts, and other approaches to inject configuration into my application and use a consistent approach to managing my configuration.</p>
<p>I have to be transparent and say that I changes to 1password references would require a re-deployment of the application, which might not be ideal for some use cases. If you work solo or in a small team where configuration might not change frequently, this might be a good fit for you :)</p>
<p>Check out the <a href="https://github.com/rafaelbroseghini/op-viper">repository</a> for more details!</p>

    
  </div>

  


  

  
  

<div class="single-pagination">
    <hr />

    <div class="flex">

        <div class="single-pagination-prev">
            
            <div class="single-pagination-container-prev">
                <div class="single-pagination-text">←</div>
                <div class="single-pagination-text">
                    <a href="/posts/uuid7/">
                        uuid7 - indexable and time sortable
                    </a>
                </div>
            </div>
            
        </div>

        <div class="single-pagination-next">
            
        </div>

    </div>

    <hr />
</div>



  

  

  
  <div class="back-to-top">
    <a href="#top">
      back to top
    </a>
  </div>
  

</div>


    </main>
  </div>

  <footer>
    


  </footer>

  

</body>

<script>

  function isAuto() {
    return document.body.classList.contains("auto");
  }

  function setTheme() {
    if (!isAuto()) {
      return
    }

    document.body.classList.remove("auto");
    let cls = "light";
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      cls = "dark";
    }

    document.body.classList.add(cls);
  }

  function invertBody() {
    document.body.classList.toggle("dark");
    document.body.classList.toggle("light");
  }

  if (isAuto()) {
    window.matchMedia('(prefers-color-scheme: dark)').addListener(invertBody);
  }

  setTheme();

</script>

<script defer src="/js/copy-code.js"></script>
</html>